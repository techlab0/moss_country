# MOSS COUNTRY ウェブサイト

北海道初のカプセルテラリウム専門店の完全統合Webプラットフォーム

## 🌱 プロジェクト概要

MOSS COUNTRY（モスカントリー）は札幌市西区発寒に拠点を置く北海道初のカプセルテラリウム専門店です。職人が手作業で制作する本格的なテラリウムの販売、体験ワークショップの開催、オーダーメイド制作、苔図鑑の提供を行っています。

## 🚀 技術スタック（現在の実装）

### フロントエンド
- **フレームワーク**: Next.js 15.3.5 (App Router)
- **言語**: TypeScript 5.x
- **スタイリング**: Tailwind CSS v3.4.0
- **UI コンポーネント**: カスタムコンポーネントライブラリ
- **画像最適化**: Next.js Image Component + Sanity CDN

### バックエンド・データベース
- **CMS**: Sanity CMS 3.98.1（コンテンツ管理）
- **データベース**: Supabase PostgreSQL（ユーザー・監査ログ）
- **認証**: JWT + Multi-Factor Authentication
- **決済**: Square Payment System
- **メール**: EmailJS（クライアントサイド）

### デプロイ・運用
- **本番環境**: Vercel Platform
- **ドメイン**: https://moss-country.vercel.app
- **監視**: Vercel Analytics + Custom Logging
- **セキュリティ**: HTTPS + 包括的認証システム

## 📁 プロジェクト構造（現在）

```
moss_country/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── page.tsx            # トップページ
│   │   ├── products/           # 商品ページ・決済システム
│   │   ├── workshop/           # ワークショップ
│   │   ├── store/              # 店舗情報
│   │   ├── story/              # 企業ストーリー
│   │   ├── contact/            # お問い合わせ（EmailJS統合）
│   │   ├── blog/               # ブログ・ニュース管理
│   │   ├── moss-guide/         # 苔図鑑システム
│   │   ├── checkout/           # チェックアウト・決済
│   │   ├── maintenance/        # メンテナンスページ
│   │   ├── admin/              # 管理画面システム
│   │   │   ├── dashboard/      # ダッシュボード
│   │   │   ├── products/       # 商品管理
│   │   │   ├── orders/         # 注文管理
│   │   │   ├── inventory/      # 在庫管理
│   │   │   ├── customers/      # 顧客管理
│   │   │   ├── blog/           # ブログ管理
│   │   │   ├── moss-guide/     # 苔図鑑管理
│   │   │   ├── contacts/       # お問い合わせ管理
│   │   │   ├── settings/       # サイト設定・メンテナンス
│   │   │   ├── users/          # ユーザー管理
│   │   │   └── security/       # セキュリティ管理
│   │   └── api/                # API エンドポイント
│   │       ├── admin/          # 管理機能API
│   │       ├── products/       # 商品API
│   │       ├── contact/        # お問い合わせAPI
│   │       ├── maintenance/    # メンテナンス制御API
│   │       └── webhooks/       # Square決済Webhook
│   ├── components/             # 再利用可能コンポーネント
│   │   ├── admin/              # 管理画面専用
│   │   ├── layout/             # レイアウト関連
│   │   ├── ui/                 # UIコンポーネント
│   │   ├── sections/           # セクションコンポーネント
│   │   ├── products/           # 商品関連
│   │   ├── checkout/           # 決済関連
│   │   ├── maintenance/        # メンテナンス関連
│   │   └── seo/                # SEO関連
│   ├── lib/                    # ユーティリティ・API連携
│   │   ├── sanity.ts           # Sanity CMS統合
│   │   ├── auth.ts             # 認証システム
│   │   ├── supabase.ts         # Supabase連携
│   │   └── square.ts           # Square決済
│   └── types/                  # TypeScript型定義
├── sanity/                     # Sanity CMS設定
│   └── schemas/                # データスキーマ
├── public/
│   └── images/                 # 静的画像アセット
└── docs/                       # プロジェクト設計書
```

## 🎨 ブランドカラー

```css
moss-green: #2D5016    /* メインカラー */
light-green: #8FBC8F   /* アクセントカラー */
warm-brown: #8B4513    /* サブカラー */
beige: #F5F5DC         /* 背景カラー */
light-blue: #F0F8FF    /* セクション背景 */
```

## 🖥️ 開発環境構築

### 前提条件
- Node.js 18以上
- npm または yarn

### インストール

```bash
# リポジトリをクローン
git clone <repository-url>
cd moss_country

# 依存関係をインストール
npm install

# 開発サーバーを起動
npm run dev
```

### プレビュー表示

**方法1: 開発サーバー**
```bash
npm run dev
```
http://localhost:3000 にアクセス

**方法2: 静的プレビュー**
```bash
# ブラウザでpreview.htmlを直接開く
open preview.html
```

## 📋 実装完了機能（Phase 15.0）

### ✅ コアWebサイト機能
- [x] **レスポンシブデザイン**: モバイル・タブレット・デスクトップ完全対応
- [x] **フルページ実装**: トップ・商品・ワークショップ・店舗・ストーリー・お問い合わせ
- [x] **SEO最適化**: メタデータ・構造化データ・サイトマップ完備
- [x] **アクセシビリティ**: WCAG準拠・キーボードナビゲーション
- [x] **多言語対応準備**: 日本語・英語URLスラッグ対応

### ✅ ECサイト・決済システム
- [x] **商品管理**: Sanity CMS統合・在庫管理・カテゴリ分類
- [x] **ショッピングカート**: 追加・削除・数量変更・セッション管理
- [x] **決済システム**: Square Payment完全統合・リアルタイム処理
- [x] **注文管理**: 受注・ステータス管理・履歴・Webhook統合
- [x] **在庫管理**: リアルタイム在庫・低在庫アラート・予約システム

### ✅ コンテンツ管理システム
- [x] **ブログ・ニュース**: 記事作成・編集・公開管理・統計分析
- [x] **苔図鑑**: 北海道特化苔データベース・画像管理・検索システム
- [x] **Sanity CMS**: ヘッドレスCMS完全統合・リアルタイム更新
- [x] **画像最適化**: WebP対応・レスポンシブ画像・CDN配信

### ✅ 管理画面・認証システム
- [x] **多要素認証**: SMS・Google OAuth・端末コード対応
- [x] **包括的管理画面**: 商品・注文・在庫・顧客・コンテンツ管理
- [x] **ユーザー管理**: 複数ユーザー・役割ベースアクセス制御
- [x] **セキュリティ**: 監査ログ・セキュリティアラート・異常検知
- [x] **動的メンテナンス**: リアルタイムメンテナンスモード制御

### ✅ 通信・連携機能
- [x] **お問い合わせ**: EmailJS統合・Supabase保存・フォーム機能
- [x] **メール送信**: 自動返信・通知メール・HTMLテンプレート
- [x] **API統合**: RESTful API・Webhook・外部サービス連携

### ✅ 運用・デプロイ
- [x] **Vercelデプロイ**: 本番環境稼働中・CI/CD対応
- [x] **環境変数管理**: 開発・本番環境分離・セキュア設定
- [x] **エラーハンドリング**: 包括的エラー処理・ユーザーフィードバック
- [x] **パフォーマンス**: 画像最適化・コード分割・キャッシュ戦略

## 📄 ページ構成（現在稼働中）

### 🌍 公開ページ
| ページ | パス | 説明 | 状態 |
|--------|------|------|------|
| **トップページ** | `/` | メインランディング・新着情報 | ✅ 稼働中 |
| **商品一覧** | `/products` | 商品カタログ・カート機能 | ✅ 稼働中 |
| **商品詳細** | `/products/[slug]` | 個別商品詳細・購入 | ✅ 稼働中 |
| **ワークショップ** | `/workshop` | 体験コース・予約 | ✅ 稼働中 |
| **企業ストーリー** | `/story` | ブランド・代表者紹介 | ✅ 稼働中 |
| **店舗情報** | `/store` | アクセス・営業情報 | ✅ 稼働中 |
| **お問い合わせ** | `/contact` | フォーム・FAQ | ✅ 稼働中 |
| **ブログ・ニュース** | `/blog` | 記事一覧・カテゴリ | ✅ 稼働中 |
| **記事詳細** | `/blog/[slug]` | 個別記事表示 | ✅ 稼働中 |
| **苔図鑑** | `/moss-guide` | 苔データベース・検索 | ✅ 稼働中 |
| **苔詳細** | `/moss-guide/[slug]` | 個別苔情報・育て方 | ✅ 稼働中 |
| **決済** | `/checkout` | Square決済システム | ✅ 稼働中 |
| **決済完了** | `/payment/success` | 注文確認ページ | ✅ 稼働中 |

### 🔧 管理システム
| ページ | パス | 説明 | 状態 |
|--------|------|------|------|
| **ログイン** | `/admin/login` | 管理者認証・2FA | ✅ 稼働中 |
| **ダッシュボード** | `/admin/dashboard` | 統計・概要表示 | ✅ 稼働中 |
| **商品管理** | `/admin/products` | 商品CRUD・在庫管理 | ✅ 稼働中 |
| **注文管理** | `/admin/orders` | 受注・発送管理 | ✅ 稼働中 |
| **顧客管理** | `/admin/customers` | 顧客情報・購入履歴 | ✅ 稼働中 |
| **在庫管理** | `/admin/inventory` | 在庫状況・アラート | ✅ 稼働中 |
| **ブログ管理** | `/admin/blog` | 記事作成・編集・公開 | ✅ 稼働中 |
| **苔図鑑管理** | `/admin/moss-guide` | 苔データ管理・画像 | ✅ 稼働中 |
| **お問い合わせ管理** | `/admin/contacts` | 問い合わせ対応 | 🔄 実装待ち |
| **ユーザー管理** | `/admin/users` | 管理者アカウント | ✅ 稼働中 |
| **サイト設定** | `/admin/settings` | メンテナンス・設定 | ✅ 稼働中 |
| **セキュリティ** | `/admin/security-*` | 監査・アラート | ✅ 稼働中 |

### 🔒 システムページ
| ページ | パス | 説明 | 状態 |
|--------|------|------|------|
| **メンテナンス** | `/maintenance` | メンテナンス中表示 | ✅ 稼働中 |
| **プライバシーポリシー** | `/privacy` | 個人情報保護方針 | ✅ 稼働中 |
| **利用規約** | `/terms` | サービス利用規約 | ✅ 稼働中 |
| **特定商取引法** | `/legal` | 法的表記 | ✅ 稼働中 |

## 🔐 セキュリティ・認証

### 多要素認証システム
- **SMS認証**: Twilio統合
- **Google OAuth**: Googleアカウント連携  
- **端末コード**: 6桁コード表示（5分間有効）
- **セッション管理**: JWT + HTTPOnly Cookie

### セキュリティ機能
- **監査ログ**: 全操作記録・異常検知
- **アクセス制御**: Role-Based Access Control
- **データ暗号化**: パスワードハッシュ化・通信暗号化
- **メンテナンスモード**: 動的制御・パスワード保護

## 🎯 SEO・パフォーマンス

### SEO最適化
- **構造化データ**: JSON-LD対応
- **メタデータ**: 各ページ個別設定
- **OGP対応**: SNSシェア最適化
- **キーワード**: 「MOSS COUNTRY」「モスカントリー」「苔テラリウム」最適化
- **サイトマップ**: 自動生成・検索エンジン対応

### パフォーマンス
- **画像最適化**: WebP・レスポンシブ・CDN配信
- **コード分割**: Dynamic Imports・Lazy Loading
- **キャッシュ**: ISR・SWR・Browser Cache
- **ローディング**: プログレスバー・スムーズ体験

## 📱 デバイス対応

- **モバイル**: 375px~ （iPhone SE以上）
- **タブレット**: 768px~ （iPad以上）
- **デスクトップ**: 1024px~ （一般的なPC）
- **大画面**: 1280px~ （ワイドモニター）
- **背景画像**: デスクトップ/モバイル別画像・20%明度調整

## 🚀 開発・デプロイ

### 本番環境
```bash
# 本番サイト
https://moss-country.vercel.app

# 管理画面
https://moss-country.vercel.app/admin/login
```

### 開発コマンド
```bash
# 開発サーバー起動
npm run dev

# プロダクションビルド  
npm run build

# 型チェック・リント
npm run lint
npm run type-check
```

### 環境変数設定
- **Sanity CMS**: プロジェクトID・API Token
- **Supabase**: URL・Service Role Key
- **Square決済**: Application ID・Access Token・Location ID
- **EmailJS**: Service ID・Template ID・Public Key
- **認証**: JWT Secret・NextAuth URL

## 📊 運用状況

### ✅ 稼働中機能
- **📈 完全稼働**: ECサイト・決済・管理画面・認証
- **🔄 データフロー**: 注文→決済→在庫更新→メール送信
- **🛡️ セキュリティ**: 24時間監視・自動アラート
- **📱 アクセス**: モバイル75%・デスクトップ25%

### 📋 次期実装
- [ ] **お問い合わせ管理**: 管理画面でのお問い合わせ対応機能
- [ ] **会員システム**: 顧客アカウント・ポイント機能
- [ ] **在庫自動発注**: 低在庫時の自動補充システム
- [ ] **レビューシステム**: 商品評価・口コミ機能

## 📚 技術ドキュメント

詳細な設計書・仕様書：

- **`SYSTEM_REQUIREMENTS.md`** - システム要件定義書
- **`/docs/`フォルダ** - プロジェクト設計書・開発履歴
- **Sanity Studio** - https://moss-country.sanity.studio
- **API仕様** - `/api/*` エンドポイント

## 🤝 運用・保守

### 日常運用
- **コンテンツ更新**: ブログ記事・商品情報・苔図鑑
- **注文処理**: 受注確認・在庫管理・発送作業
- **顧客対応**: お問い合わせ・決済サポート

### 定期保守
- **セキュリティ**: 週次脆弱性チェック
- **パフォーマンス**: 月次最適化・監視
- **バックアップ**: 日次自動・月次確認

## 📞 店舗情報

**MOSS COUNTRY 札幌本店**
- **住所**: 北海道札幌市西区発寒11条4丁目3-1
- **電話**: 080-3605-6340
- **メール**: moss.country.kokenokuni@gmail.com
- **営業**: 11:00-20:00（不定休）
- **駐車場**: あり

---

**開発状況**: ✅ **Phase 15.0完了** - 動的メンテナンスモード実装完了  
**システム状態**: 🟢 **本番稼働中** - 全機能正常稼働  
**最終更新**: 2025年10月20日